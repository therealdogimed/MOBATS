module.exports=[18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},23515,e=>{"use strict";let t={brokers:[{id:"alpaca-1",name:"Alpaca Paper Trading",type:"Alpaca",connected:!0,equity:1e5,buyingPower:1e5,positions:0,openPositions:0,todayPL:0,pl:0,positionsList:[],lockedTradingCapital:45e3,reserveCapital:55e3,apiKey:"your-api-key",apiSecret:"your-api-secret",mode:"paper"}],strategies:[{id:"dividend-1",name:"Dividend Growth Strategy",type:"Long-term Dividend",running:!1,allocation:60,plToday:0,plTotal:0,winRate:0,stopLoss:5,takeProfit:20,maxPositionSize:1e4,aiOptimization:!0},{id:"scalping-1",name:"High-Volatility Scalper",type:"Day Trading Scalper",running:!1,allocation:40,plToday:0,plTotal:0,winRate:0,stopLoss:1,takeProfit:2,maxPositionSize:5e3,aiOptimization:!0}],plHistory:[],transactions:[],settings:{aiModel:"openai/gpt-4o",aiRiskManagement:!0,maxDrawdown:10,maxDailyLoss:1e3,defaultStopLoss:1,defaultTakeProfit:2}},r=new Map;async function a(){try{let a=t.brokers.filter(e=>"alpaca"===e.type.toLowerCase());if(0===a.length)return;for(let t of a){if("paper"===t.mode&&"live"===process.env.ALPACA_MODE){console.log("[v0] bot-state: Skipping paper account in live trading mode",{brokerId:t.id,brokerName:t.name}),t.connected=!1;continue}if(!t.apiKey||!t.apiSecret||"your-api-key"===t.apiKey||"your-api-secret"===t.apiSecret){t.connected=!1;continue}let a=r.get(t.id)||0;if(a>=3){t.connected=!1;continue}let{createAlpacaClient:o}=await e.A(12296),i=o(t.apiKey,t.apiSecret,t.mode);if(!i.isConfigured()){t.connected=!1;continue}let n=await i.verifyConnection();if(!n.success){(n.error?.includes("401")||n.error?.includes("unauthorized"))&&(r.set(t.id,a+1),a+1>=3&&console.error("[v0] bot-state: Max auth failures reached, stopping sync for broker",{brokerId:t.id,brokerName:t.name,message:"Please configure valid API credentials in the broker settings"})),t.connected=!1;continue}r.delete(t.id);let[s,l]=await Promise.all([i.getAccount(),i.getPositions()]),c=t.equity;t.equity=Number.parseFloat(s.portfolio_value),t.buyingPower=Number.parseFloat(s.buying_power),t.positions=l.length,t.openPositions=l.length,t.positionsList=l.map(e=>({symbol:e.symbol,qty:Number.parseFloat(e.qty),entryPrice:Number.parseFloat(e.market_value)/Number.parseFloat(e.qty),currentPrice:Number.parseFloat(e.market_value)/Number.parseFloat(e.qty),pl:Number.parseFloat(e.unrealized_pl),plPercent:100*Number.parseFloat(e.unrealized_plpc)}));let u=t.positionsList.reduce((e,t)=>e+t.pl,0);t.pl=u,t.todayPL=u,c!==t.equity&&(t.reserveCapital=t.equity-t.lockedTradingCapital),t.connected=!0,console.log("[v0] bot-state: Alpaca data synced successfully",{brokerId:t.id,mode:i.getMode(),equity:t.equity,buyingPower:t.buyingPower,positions:l.length})}}catch(e){console.error("[v0] bot-state: Failed to sync Alpaca data:",e)}}function o(){return t}function i(e){let r={id:`${e.type.toLowerCase()}-${Date.now()}`,name:e.name,type:e.type.toLowerCase(),connected:!1,equity:0,buyingPower:0,positions:0,openPositions:0,todayPL:0,pl:0,positionsList:[],lockedTradingCapital:0,reserveCapital:0,apiKey:e.apiKey,apiSecret:e.apiSecret,mode:e.mode||"paper"};return t.brokers.push(r),"alpaca"===r.type&&r.apiKey&&r.apiSecret&&(console.log("[v0] bot-state: New Alpaca broker added, triggering sync..."),a().catch(e=>{console.error("[v0] bot-state: New broker sync error:",e)})),r}function n(e){t.brokers=t.brokers.filter(t=>t.id!==e)}function s(e,r){let a=t.strategies.find(t=>t.id===e);a&&(a.running="start"===r)}function l(e){t.strategies.forEach(t=>{t.running="start"===e})}function c(e,r){let a=t.strategies.find(t=>t.id===e);a&&(a.allocation=r)}function u(e){t.settings={...t.settings,...e}}function d(e,r){let a=t.brokers.find(t=>t.id===e);a?(console.log("[v0] bot-state: Before update",{brokerId:e,oldLockedCapital:a.lockedTradingCapital,oldReserveCapital:a.reserveCapital,equity:a.equity,buyingPower:a.buyingPower,requestedAmount:r}),a.lockedTradingCapital=r,a.reserveCapital=a.equity-r,console.log("[v0] bot-state: After update",{brokerId:e,newLockedCapital:a.lockedTradingCapital,newReserveCapital:a.reserveCapital,equity:a.equity,buyingPower:a.buyingPower})):console.error("[v0] bot-state: Broker not found for capital update",{brokerId:e})}function p(e){let r=t.brokers.find(t=>t.id===e);if(r){let t=Math.max(r.equity,.5*r.buyingPower);r.lockedTradingCapital=.45*t,r.reserveCapital=r.equity-r.lockedTradingCapital,console.log("[v0] bot-state: Auto-locked trading capital",{brokerId:e,baseCapital:t,lockedCapital:r.lockedTradingCapital,reserveCapital:r.reserveCapital})}}function g(e){let r=t.brokers.find(t=>t.id===e);return r?{apiKey:r.apiKey,apiSecret:r.apiSecret,mode:r.mode}:null}function y(){return t.brokers.find(e=>"alpaca"===e.type.toLowerCase())||null}function h(e,o,i){let n=t.brokers.find(t=>t.id===e);n&&(n.apiKey=o,n.apiSecret=i,r.delete(e),console.log("[v0] bot-state: Broker credentials updated",{brokerId:e,hasApiKey:!!o,hasApiSecret:!!i}),"alpaca"===n.type&&o&&i&&(console.log("[v0] bot-state: Alpaca credentials updated, triggering sync..."),a().catch(e=>{console.error("[v0] bot-state: Credentials update sync error:",e)})))}e.s(["addBroker",()=>i,"getAlpacaBroker",()=>y,"getBotState",()=>o,"getBrokerCredentials",()=>g,"lockTradingCapital",()=>p,"removeBroker",()=>n,"syncAlpacaData",()=>a,"toggleAllStrategies",()=>l,"toggleStrategy",()=>s,"updateBrokerCredentials",()=>h,"updateBrokerTradingCapital",()=>d,"updateSettings",()=>u,"updateStrategyAllocation",()=>c],23515)},9108,e=>{"use strict";class t{baseUrl;dataUrl;apiKey;apiSecret;hasCredentials;mode;lastVerification=null;constructor(e,t,r){this.apiKey=e||process.env.ALPACA_API_KEY||"",this.apiSecret=t||process.env.ALPACA_API_SECRET||"",this.hasCredentials=!!(this.apiKey&&this.apiSecret),this.mode=r||("live"===process.env.ALPACA_MODE?"live":"paper"),this.baseUrl="paper"===this.mode?"https://paper-api.alpaca.markets":"https://api.alpaca.markets",this.dataUrl="https://data.alpaca.markets",console.log("[v0] Alpaca: Client initialized",{mode:this.mode.toUpperCase(),baseUrl:this.baseUrl,hasCredentials:this.hasCredentials,credentialSource:e?"broker config":"environment variables"})}isConfigured(){return this.hasCredentials}getMode(){return this.mode}async verifyConnection(){if(!this.hasCredentials)return{success:!1,error:"No credentials configured"};try{console.log("[v0] Alpaca: Verifying connection...",{mode:this.mode});let e=await this.getAccount();return console.log("[v0] Alpaca: Connection verified successfully",{accountNumber:e.account_number,status:e.status,mode:this.mode,equity:e.equity,buyingPower:e.buying_power,tradingBlocked:e.trading_blocked,patternDayTrader:e.pattern_day_trader}),this.lastVerification={success:!0,timestamp:Date.now(),account:e},{success:!0,account:e}}catch(t){let e=t instanceof Error?t.message:String(t);return console.error("[v0] Alpaca: Connection verification failed",{mode:this.mode,error:e}),this.lastVerification={success:!1,timestamp:Date.now()},{success:!1,error:e}}}getLastVerification(){return this.lastVerification}getHeaders(){return console.log("[v0] Alpaca: Request headers",{hasKeyId:!!this.apiKey,hasSecret:!!this.apiSecret,keyIdPrefix:this.apiKey?.substring(0,8)+"..."}),{"APCA-API-KEY-ID":this.apiKey,"APCA-API-SECRET-KEY":this.apiSecret,"Content-Type":"application/json"}}async request(e,t){if(!this.hasCredentials)throw Error("Alpaca API credentials not configured");try{let r=await fetch(e,{...t,headers:{...this.getHeaders(),...t?.headers}});if(!r.ok){let t=await r.text();throw console.error("[v0] Alpaca: API error",{status:r.status,statusText:r.statusText,error:t,url:e}),Error(`Alpaca API error (${r.status}): ${t}`)}return await r.json()}catch(t){throw console.error("[v0] Alpaca: Request failed",{url:e,error:t}),t}}async getAccount(){return await this.request(`${this.baseUrl}/v2/account`)}async getPositions(){return this.request(`${this.baseUrl}/v2/positions`)}async getClock(){return await this.request(`${this.baseUrl}/v2/clock`)}async getQuote(e){return this.request(`${this.dataUrl}/v2/stocks/${e}/quotes/latest`)}async getLatestBars(e){let t=e.join(","),r=`${this.dataUrl}/v2/stocks/bars/latest?symbols=${t}&feed=iex`;return(await this.request(r)).bars}async getLatestQuote(e){let t=`${this.dataUrl}/v2/stocks/${e}/quotes/latest?feed=iex`;return(await this.request(t)).quote}async createOrder(e){if(console.log("[v0] Alpaca: Preparing to place order",{symbol:e.symbol,qty:e.qty,side:e.side,type:e.type,time_in_force:e.time_in_force,mode:this.mode,baseUrl:this.baseUrl}),!this.hasCredentials)throw Error("Alpaca API credentials not configured");try{let e=await this.getClock(),t=new Date;if(e.is_open)console.log("[v0] Alpaca: ✅ Market is OPEN - Order will execute immediately");else{let r=((new Date(e.next_open).getTime()-t.getTime())/36e5).toFixed(1);console.warn("[v0] Alpaca: ⚠️ MARKET IS CLOSED - Order will be queued",{currentTime:t.toISOString(),nextOpen:e.next_open,hoursUntilOpen:r,message:"This order will NOT execute until market opens at 9:30 AM ET"})}}catch(e){console.warn("[v0] Alpaca: Could not check market hours",e)}try{let e=await this.getAccount();if(console.log("[v0] Alpaca: Account status before order",{accountNumber:e.account_number,equity:e.equity,buyingPower:e.buying_power,cash:e.cash,tradingBlocked:e.trading_blocked,status:e.status}),e.trading_blocked)throw Error("❌ Trading is blocked on this account");let t=Number.parseFloat(e.buying_power);if(t<=0)throw Error(`❌ Insufficient buying power: $${t}`)}catch(e){throw console.error("[v0] Alpaca: Account check failed before order",e),e}try{let t=await this.request(`${this.baseUrl}/v2/orders`,{method:"POST",body:JSON.stringify(e)});return console.log("[v0] Alpaca: ✅ Order placed successfully",{orderId:t.id,status:t.status,symbol:t.symbol,qty:t.qty,side:t.side,submittedAt:t.submitted_at,mode:this.mode}),t}catch(t){throw console.error("[v0] Alpaca: ❌ Order placement failed",{order:e,mode:this.mode,error:t instanceof Error?t.message:String(t)}),t}}async cancelAllOrders(){return this.request(`${this.baseUrl}/v2/orders`,{method:"DELETE"})}async closeAllPositions(){return this.request(`${this.baseUrl}/v2/positions`,{method:"DELETE"})}async isMarketOpen(){try{return(await this.getClock()).is_open}catch(e){return console.error("[v0] Alpaca: Failed to check market hours",e),!1}}async getHistoricalBars(e,t,r,a){let o=`${this.dataUrl}/v2/stocks/${e}/bars?timeframe=${t}&start=${r}&end=${a}&feed=iex`;return(await this.request(o)).bars||[]}async getRealtimeQuotes(e){let t={};for(let r of e)try{t[r]=await this.getLatestQuote(r)}catch(e){console.warn(`[v0] Alpaca: Failed to get quote for ${r}`,e)}return t}}function r(e,r,a){return new t(e,r,a)}function a(){return new t}e.s(["AlpacaClient",()=>t,"createAlpacaClient",()=>r,"getAlpacaClient",()=>a])},90394,e=>{"use strict";var t=e.i(9108),r=e.i(23515);class a{client;isRunning=!1;intervalId=null;currentStatus;strategy;constructor(){this.client=null,this.currentStatus={isRunning:!1,positions:[],accountValue:"0",buyingPower:"0",lastUpdate:new Date().toISOString()},this.strategy={shouldBuy:async(e,t)=>!1,shouldSell:async(e,t)=>!1}}getClient(){let e=(0,r.getAlpacaBroker)();return e&&e.apiKey&&e.apiSecret?(this.client=(0,t.createAlpacaClient)(e.apiKey,e.apiSecret,e.mode),this.client):null}async start(){this.isRunning?console.log("[v0] Bot is already running"):(console.log("[v0] Starting bot engine..."),this.isRunning=!0,await this.updateStatus(),this.intervalId=setInterval(()=>{this.tradingLoop().catch(e=>{console.error("[v0] Trading loop error:",e),this.currentStatus.error=e instanceof Error?e.message:"Unknown error"})},3e4),console.log("[v0] Bot engine started"))}async stop(){this.isRunning?(console.log("[v0] Stopping bot engine..."),this.isRunning=!1,this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null),await this.updateStatus(),console.log("[v0] Bot engine stopped")):console.log("[v0] Bot is already stopped")}async getStatus(){return await this.updateStatus(),this.currentStatus}async updateStatus(){try{console.log("[v0] BotEngine: Updating bot status...");let e=this.getClient();if(!e||!e.isConfigured()){this.currentStatus={isRunning:this.isRunning,positions:[],accountValue:"0",buyingPower:"0",lastUpdate:new Date().toISOString(),error:"Alpaca credentials not configured"};return}let[t,r]=await Promise.all([e.getAccount(),e.getPositions()]);console.log("[v0] BotEngine: Received account data",{portfolioValue:t.portfolio_value,buyingPower:t.buying_power,positionCount:r.length}),this.currentStatus={isRunning:this.isRunning,positions:r.map(e=>({symbol:e.symbol,qty:e.qty,market_value:e.market_value,unrealized_pl:e.unrealized_pl,unrealized_plpc:e.unrealized_plpc})),accountValue:t.portfolio_value,buyingPower:t.buying_power,lastUpdate:new Date().toISOString(),error:void 0},console.log("[v0] BotEngine: Status updated successfully",{isRunning:this.currentStatus.isRunning,positionCount:this.currentStatus.positions.length,accountValue:this.currentStatus.accountValue,buyingPower:this.currentStatus.buyingPower})}catch(e){console.error("[v0] BotEngine: Failed to update status:",e),this.currentStatus.error=e instanceof Error?e.message:"Failed to fetch data"}}async tradingLoop(){if(!this.isRunning)return;let e=this.getClient();if(e&&e.isConfigured()){console.log("[v0] BotEngine: Running trading loop...");try{await this.updateStatus();let t=await e.getPositions(),r=await e.getClock();if(!r.is_open)return void console.log("[v0] BotEngine: ⚠️ Market is CLOSED - Skipping trading",{currentTime:new Date().toISOString(),nextOpen:r.next_open});for(let a of(console.log("[v0] BotEngine: ✅ Market is OPEN - Ready to trade",{timestamp:r.timestamp,nextClose:r.next_close}),t)){let t=await e.getQuote(a.symbol),r=Number.parseFloat(t.ap);if(await this.strategy.shouldSell(a.symbol,r)){console.log(`[v0] BotEngine: Sell signal for ${a.symbol}`),console.log("[v0] BotEngine: Placing LIVE SELL order",{symbol:a.symbol,qty:a.qty,currentPrice:r,orderType:"market"});let t=await e.createOrder({symbol:a.symbol,qty:a.qty,side:"sell",type:"market",time_in_force:"day"});console.log("[v0] BotEngine: LIVE SELL order submitted",{orderId:t.id,status:t.status,symbol:a.symbol})}}for(let t of["AAPL","GOOGL","MSFT","TSLA"]){let r=await e.getQuote(t),a=Number.parseFloat(r.bp);if(await this.strategy.shouldBuy(t,a)){console.log(`[v0] BotEngine: Buy signal for ${t}`);let r=await e.getAccount(),o=Number.parseFloat(r.buying_power);console.log("[v0] BotEngine: Using buying power from API",{buyingPower:o,portfolioValue:r.portfolio_value});let i=.05*o,n=Math.floor(i/a);if(console.log("[v0] BotEngine: Calculated trade size",{symbol:t,buyingPower:o,tradeAmount:i,currentPrice:a,qty:n}),n>0){console.log("[v0] BotEngine: Placing LIVE BUY order",{symbol:t,qty:n,currentPrice:a,tradeAmount:i.toFixed(2),orderType:"market"});let r=await e.createOrder({symbol:t,qty:n.toString(),side:"buy",type:"market",time_in_force:"day"});console.log("[v0] BotEngine: LIVE BUY order submitted",{orderId:r.id,status:r.status,symbol:t,qty:n})}else console.log("[v0] BotEngine: Insufficient buying power for trade",{symbol:t,buyingPower:o,currentPrice:a})}}}catch(e){throw console.error("[v0] BotEngine: Trading loop error:",e),e}}}}let o=null;function i(){return o||(o=new a),o}e.s(["getBotEngine",()=>i])},46471,e=>{"use strict";var t=e.i(47909),r=e.i(74017),a=e.i(96250),o=e.i(59756),i=e.i(61916),n=e.i(14444),s=e.i(37092),l=e.i(69741),c=e.i(16795),u=e.i(87718),d=e.i(95169),p=e.i(47587),g=e.i(66012),y=e.i(70101),h=e.i(26937),m=e.i(10372),f=e.i(93695);e.i(52474);var v=e.i(220),b=e.i(89171),w=e.i(90394);async function A(){try{let e=(0,w.getBotEngine)(),t=await e.getStatus();return b.NextResponse.json(t)}catch(e){return console.error("[v0] Status endpoint error:",e),b.NextResponse.json({error:e instanceof Error?e.message:"Failed to get status",isRunning:!1,positions:[],accountValue:"0",buyingPower:"0",lastUpdate:new Date().toISOString()},{status:500})}}e.s(["GET",()=>A,"dynamic",0,"force-dynamic"],82601);var C=e.i(82601);let k=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/bot/status/route",pathname:"/api/bot/status",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/bot/status/route.ts",nextConfigOutput:"",userland:C}),{workAsyncStorage:S,workUnitAsyncStorage:E,serverHooks:P}=k;function R(){return(0,a.patchFetch)({workAsyncStorage:S,workUnitAsyncStorage:E})}async function x(e,t,a){k.isDev&&(0,o.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let b="/api/bot/status/route";b=b.replace(/\/index$/,"")||"/";let w=await k.prepare(e,t,{srcPage:b,multiZoneDraftMode:!1});if(!w)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:A,params:C,nextConfig:S,parsedUrl:E,isDraftMode:P,prerenderManifest:R,routerServerContext:x,isOnDemandRevalidate:q,revalidateOnlyGenerated:_,resolvedPathname:T,clientReferenceManifest:I,serverActionsManifest:O}=w,N=(0,l.normalizeAppPath)(b),B=!!(R.dynamicRoutes[N]||R.routes[T]),L=async()=>((null==x?void 0:x.render404)?await x.render404(e,t,E,!1):t.end("This page could not be found"),null);if(B&&!P){let e=!!R.routes[T],t=R.dynamicRoutes[N];if(t&&!1===t.fallback&&!e){if(S.experimental.adapterPath)return await L();throw new f.NoFallbackError}}let U=null;!B||k.isDev||P||(U="/index"===(U=T)?"/":U);let D=!0===k.isDev||!B,$=B&&!D;O&&I&&(0,n.setReferenceManifestsSingleton)({page:b,clientReferenceManifest:I,serverActionsManifest:O,serverModuleMap:(0,s.createServerModuleMap)({serverActionsManifest:O})});let M=e.method||"GET",K=(0,i.getTracer)(),F=K.getActiveScopeSpan(),j={params:C,prerenderManifest:R,renderOpts:{experimental:{authInterrupts:!!S.experimental.authInterrupts},cacheComponents:!!S.cacheComponents,supportsDynamicResponse:D,incrementalCache:(0,o.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:S.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>k.onRequestError(e,t,a,x)},sharedContext:{buildId:A}},H=new c.NodeNextRequest(e),V=new c.NodeNextResponse(t),z=u.NextRequestAdapter.fromNodeNextRequest(H,(0,u.signalFromNodeResponse)(t));try{let n=async e=>k.handle(z,j).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=K.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${M} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${M} ${b}`)}),s=!!(0,o.getRequestMeta)(e,"minimalMode"),l=async o=>{var i,l;let c=async({previousCacheEntry:r})=>{try{if(!s&&q&&_&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let i=await n(o);e.fetchMetrics=j.renderOpts.fetchMetrics;let l=j.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let c=j.renderOpts.collectedTags;if(!B)return await (0,g.sendResponse)(H,V,i,j.renderOpts.pendingWaitUntil),null;{let e=await i.blob(),t=(0,y.toNodeOutgoingHttpHeaders)(i.headers);c&&(t[m.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==j.renderOpts.collectedRevalidate&&!(j.renderOpts.collectedRevalidate>=m.INFINITE_CACHE)&&j.renderOpts.collectedRevalidate,a=void 0===j.renderOpts.collectedExpire||j.renderOpts.collectedExpire>=m.INFINITE_CACHE?void 0:j.renderOpts.collectedExpire;return{value:{kind:v.CachedRouteKind.APP_ROUTE,status:i.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await k.onRequestError(e,t,{routerKind:"App Router",routePath:b,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:$,isOnDemandRevalidate:q})},x),t}},u=await k.handleResponse({req:e,nextConfig:S,cacheKey:U,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:R,isRoutePPREnabled:!1,isOnDemandRevalidate:q,revalidateOnlyGenerated:_,responseGenerator:c,waitUntil:a.waitUntil,isMinimalMode:s});if(!B)return null;if((null==u||null==(i=u.value)?void 0:i.kind)!==v.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(l=u.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",q?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),P&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let d=(0,y.fromNodeOutgoingHttpHeaders)(u.value.headers);return s&&B||d.delete(m.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||d.get("Cache-Control")||d.set("Cache-Control",(0,h.getCacheControlHeader)(u.cacheControl)),await (0,g.sendResponse)(H,V,new Response(u.value.body,{headers:d,status:u.value.status||200})),null};F?await l(F):await K.withPropagatedContext(e.headers,()=>K.trace(d.BaseServerSpan.handleRequest,{spanName:`${M} ${b}`,kind:i.SpanKind.SERVER,attributes:{"http.method":M,"http.target":e.url}},l))}catch(t){if(t instanceof f.NoFallbackError||await k.onRequestError(e,t,{routerKind:"App Router",routePath:N,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:$,isOnDemandRevalidate:q})}),B)throw t;return await (0,g.sendResponse)(H,V,new Response(null,{status:500})),null}}e.s(["handler",()=>x,"patchFetch",()=>R,"routeModule",()=>k,"serverHooks",()=>P,"workAsyncStorage",()=>S,"workUnitAsyncStorage",()=>E],46471)},12296,e=>{e.v(e=>Promise.resolve().then(()=>e(9108)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__c0f51dc2._.js.map