module.exports=[9108,e=>{"use strict";class t{baseUrl;dataUrl;apiKey;apiSecret;hasCredentials;mode;lastVerification=null;constructor(e,t,r){this.apiKey=e||process.env.ALPACA_API_KEY||"",this.apiSecret=t||process.env.ALPACA_API_SECRET||"",this.hasCredentials=!!(this.apiKey&&this.apiSecret),this.mode=r||("live"===process.env.ALPACA_MODE?"live":"paper"),this.baseUrl="paper"===this.mode?"https://paper-api.alpaca.markets":"https://api.alpaca.markets",this.dataUrl="https://data.alpaca.markets",console.log("[v0] Alpaca: Client initialized",{mode:this.mode.toUpperCase(),baseUrl:this.baseUrl,hasCredentials:this.hasCredentials,credentialSource:e?"broker config":"environment variables"})}isConfigured(){return this.hasCredentials}getMode(){return this.mode}async verifyConnection(){if(!this.hasCredentials)return{success:!1,error:"No credentials configured"};try{console.log("[v0] Alpaca: Verifying connection...",{mode:this.mode});let e=await this.getAccount();return console.log("[v0] Alpaca: Connection verified successfully",{accountNumber:e.account_number,status:e.status,mode:this.mode,equity:e.equity,buyingPower:e.buying_power,tradingBlocked:e.trading_blocked,patternDayTrader:e.pattern_day_trader}),this.lastVerification={success:!0,timestamp:Date.now(),account:e},{success:!0,account:e}}catch(t){let e=t instanceof Error?t.message:String(t);return console.error("[v0] Alpaca: Connection verification failed",{mode:this.mode,error:e}),this.lastVerification={success:!1,timestamp:Date.now()},{success:!1,error:e}}}getLastVerification(){return this.lastVerification}getHeaders(){return console.log("[v0] Alpaca: Request headers",{hasKeyId:!!this.apiKey,hasSecret:!!this.apiSecret,keyIdPrefix:this.apiKey?.substring(0,8)+"..."}),{"APCA-API-KEY-ID":this.apiKey,"APCA-API-SECRET-KEY":this.apiSecret,"Content-Type":"application/json"}}async request(e,t){if(!this.hasCredentials)throw Error("Alpaca API credentials not configured");try{let r=await fetch(e,{...t,headers:{...this.getHeaders(),...t?.headers}});if(!r.ok){let t=await r.text();throw console.error("[v0] Alpaca: API error",{status:r.status,statusText:r.statusText,error:t,url:e}),Error(`Alpaca API error (${r.status}): ${t}`)}return await r.json()}catch(t){throw console.error("[v0] Alpaca: Request failed",{url:e,error:t}),t}}async getAccount(){return await this.request(`${this.baseUrl}/v2/account`)}async getPositions(){return this.request(`${this.baseUrl}/v2/positions`)}async getClock(){return await this.request(`${this.baseUrl}/v2/clock`)}async getQuote(e){return this.request(`${this.dataUrl}/v2/stocks/${e}/quotes/latest`)}async getLatestBars(e){let t=e.join(","),r=`${this.dataUrl}/v2/stocks/bars/latest?symbols=${t}&feed=iex`;return(await this.request(r)).bars}async getLatestQuote(e){let t=`${this.dataUrl}/v2/stocks/${e}/quotes/latest?feed=iex`;return(await this.request(t)).quote}async createOrder(e){if(console.log("[v0] Alpaca: Preparing to place order",{symbol:e.symbol,qty:e.qty,side:e.side,type:e.type,time_in_force:e.time_in_force,mode:this.mode,baseUrl:this.baseUrl}),!this.hasCredentials)throw Error("Alpaca API credentials not configured");try{let e=await this.getClock(),t=new Date;if(e.is_open)console.log("[v0] Alpaca: ✅ Market is OPEN - Order will execute immediately");else{let r=((new Date(e.next_open).getTime()-t.getTime())/36e5).toFixed(1);console.warn("[v0] Alpaca: ⚠️ MARKET IS CLOSED - Order will be queued",{currentTime:t.toISOString(),nextOpen:e.next_open,hoursUntilOpen:r,message:"This order will NOT execute until market opens at 9:30 AM ET"})}}catch(e){console.warn("[v0] Alpaca: Could not check market hours",e)}try{let e=await this.getAccount();if(console.log("[v0] Alpaca: Account status before order",{accountNumber:e.account_number,equity:e.equity,buyingPower:e.buying_power,cash:e.cash,tradingBlocked:e.trading_blocked,status:e.status}),e.trading_blocked)throw Error("❌ Trading is blocked on this account");let t=Number.parseFloat(e.buying_power);if(t<=0)throw Error(`❌ Insufficient buying power: $${t}`)}catch(e){throw console.error("[v0] Alpaca: Account check failed before order",e),e}try{let t=await this.request(`${this.baseUrl}/v2/orders`,{method:"POST",body:JSON.stringify(e)});return console.log("[v0] Alpaca: ✅ Order placed successfully",{orderId:t.id,status:t.status,symbol:t.symbol,qty:t.qty,side:t.side,submittedAt:t.submitted_at,mode:this.mode}),t}catch(t){throw console.error("[v0] Alpaca: ❌ Order placement failed",{order:e,mode:this.mode,error:t instanceof Error?t.message:String(t)}),t}}async cancelAllOrders(){return this.request(`${this.baseUrl}/v2/orders`,{method:"DELETE"})}async closeAllPositions(){return this.request(`${this.baseUrl}/v2/positions`,{method:"DELETE"})}async isMarketOpen(){try{return(await this.getClock()).is_open}catch(e){return console.error("[v0] Alpaca: Failed to check market hours",e),!1}}async getHistoricalBars(e,t,r,s){let a=`${this.dataUrl}/v2/stocks/${e}/bars?timeframe=${t}&start=${r}&end=${s}&feed=iex`;return(await this.request(a)).bars||[]}async getRealtimeQuotes(e){let t={};for(let r of e)try{t[r]=await this.getLatestQuote(r)}catch(e){console.warn(`[v0] Alpaca: Failed to get quote for ${r}`,e)}return t}}function r(e,r,s){return new t(e,r,s)}function s(){return new t}e.s(["AlpacaClient",()=>t,"createAlpacaClient",()=>r,"getAlpacaClient",()=>s])}];

//# sourceMappingURL=lib_alpaca-client_ts_45b176e4._.js.map